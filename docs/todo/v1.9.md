# TODO v1.9 (Requirement v1.3 → Spec v1.3 기준)

> 요구사항 출처: `docs/requirement/v1.3.md` (Use Case/흐름)
> 스펙 반영: `docs/spec/v1.3.md`
> 세부 기능은 각 TODO 진행 시 PLAN 문서에서 정의한다.
> Phase 1~3은 v1.8 시점에 완료된 내역을 보존하며, Phase 4부터 Season2 리팩터링 기준으로 재구성한다.

# Phase 1. 프로젝트 초기화

## 🔹 Epic: 개발 환경 & 규칙 수립

- ✅ 코드 컨벤션 정의 (Java, TS)
- ✅ 커밋 컨벤션 / 브랜치 전략 정의 (Conventional Commits)
- ✅ GitHub Issue 템플릿 생성
- ✅ GitHub PR 템플릿 생성
- ✅ 백엔드 Spring 초기 설정
- ✅ global 도메인 공통 구성 정의

---

# Phase 2. Member/Auth/Invitation 기반 다지기 (선행 작업 정리)

## 🔹 Epic: Member & Invitation (완료 내역 유지)

- ✅ Member 엔티티 + Repository
- ✅ Invitation 엔티티 + 상태 전환
- ✅ Auth 서비스 (Spring Security + JWT + 초대 검증)
  - ✅ Auth PLAN 세부 보완(요구/테스트 확정)
  - ✅ Spring Security Config + PasswordEncoder + JWT Provider 뼈대
  - ✅ Teacher 회원가입 API (이메일/비밀번호 암호화)
  - ✅ 로그인 API + Access/Refresh 발급
  - ✅ Refresh 토큰 재발급/로그아웃 처리
  - ✅ 초대 코드 검증 API + 초대 기반 회원가입

## 🔹 Epic: Invitation & Auth 구축

- ✅ Teacher → Assistant 초대 생성/목록/취소 API
- ✅ StudentProfile 엔티티 + Repository + CRUD (Teacher 전용), PersonlLesson 개발
- ✅ SpringDoc 기반 Swagger UI 구축 및 API 스펙 자동화
- ✅ 모든 dto 패키지 request/response로 분리 + domain/sample 패키지 삭제
- ✅ 기초 데이터 저장
- ✅ Next.js + Tailwind 기본 프로젝트 세팅 및 공용 API 클라이언트/환경 변수 구성
  - ✅ 공통 레이아웃·세션 상태·에러 처리 컴포넌트 정비
  - ✅ 홈 진입 페이지 (Hero + 로그인 카드)
  - ✅ 선생님 회원가입 페이지 구현
  - ✅ 슈퍼어드민, 선생님, 조교, 학생별 대시보드 페이지 생성 -> 각 role에 정해진 페이지로 넘어가게
  - ✅ RefreshToken을 HttpOnly 쿠키로 저장하고 AccessToken을 재발급하는 구조 도입
  - ✅ Docker Compose로 Spring Boot + MySQL + Nginx Proxy Manager를 구성하고 HTTPS Reverse Proxy 환경 구축
  - ✅ 프론트엔드를 Vercel 등 HTTPS 배포 환경으로 올리고 API 경로를 연동

# Phase 3. HTTPS 배포 및 운영 환경 확립

## 🔹 Epic: CI/CD & 배포

- ✅ Docker Compose prod 설정 정리 (prod용 override + env 템플릿)
- ✅ Terraform으로 AWS 네트워크/EC2 기본 리소스 생성
- ✅ GitHub Actions CI/CD 파이프라인 구축 (frontend 빌드 + backend 이미지 빌드/푸시)
- ✅ EC2에 Compose 배포 및 Nginx Proxy Manager 설정 자동화
- ✅ 실제 HTTPS 도메인에서 Refresh 쿠키 흐름 검증

## 🔹 Epic: Auth & Invitation 운영 검증

- ✅ 로그아웃 기능 개발 및 대시보드 UI 개선
- ✅ 조교와 학생 관리 및 초대 기능 연동 및 개발
  - ✅ 조교 및 학생 관리 (목록) 기능 연동 및 개발
    - ✅ 백엔드 개발
    - ✅ 프론트엔드 개발
  - ✅ 초대 기능 연동 및 개발
    - ✅ 백엔드 개발
    - ✅ 프론트엔드 개발

---

# Phase 4. Season2 도메인 파운데이션 (엔티티/레포지토리)

> 목표: `docs/plan/backend/season2/entity-refactor-plan.md` Phase 7(작업 순서 Step 1~9)을 그대로 따라 엔티티/레포지토리 뼈대를 구축한다. 서비스/컨트롤러는 Phase 5 이후에 다룬다.

## 🔹 Step 1: 기반 엔티티 & Enum (Company/Branch)

- ⚪ PLAN: `docs/plan/backend/season2/entity-step1_plan.md`
- ⚪ CompanyType/CompanyStatus Enum 생성
- ⚪ Company 엔티티 + Repository + 기본 테스트
- ⚪ Branch 엔티티 + Repository + 기본 테스트

## 🔹 Step 2: Member 역할/프로필 분리

- ⚪ Member 엔티티를 `roles: List<MemberRole)` + phoneNumber unique 제거 + teacherId 필드 삭제
- ⚪ TeacherInfo 엔티티/Repository 스켈레톤 생성 + 기본 단위 테스트
- ⚪ StudentInfo 엔티티/Repository 스켈레톤 생성 + 기본 단위 테스트
- ⚪ Auth/MemberPrincipal/시큐리티 설정이 새로운 roles 구조로 컴파일되도록 최소 수정

## 🔹 Step 3: 배정 관계 엔티티

- ⚪ PLAN: `docs/plan/backend/season2/entity-step3_plan.md`
- ⚪ TeacherBranchAssignment 엔티티 + Repository (role/isActive, 인덱스)
- ⚪ TeacherAssistantAssignment 엔티티 + Repository (teacherMemberId/assistantMemberId/isActive)

## 🔹 Step 4: Course/Enrollment 기반 데이터 정비

- ⚪ PLAN: `docs/plan/backend/season2/entity-step4_plan.md`
- ⚪ Course 엔티티 branchId/teacherMemberId 필드 교체 및 관련 FK/인덱스 적용
- ⚪ EnrollmentStatus Enum 생성
- ⚪ StudentEnrollmentRequest 엔티티 + Repository (status/message/processedAt/processedBy)
- ⚪ StudentCourseEnrollment 엔티티 studentMemberId로 변경 + enrolledAt 필드 추가

## 🔹 Step 5: StudentCourseRecord 변환

- ⚪ StudentProfile → StudentCourseRecord 마이그레이션 설계 (엔티티/Repository/테스트)
- ⚪ StudentCourseRecordRepository 생성 (unique(studentMemberId, courseId))

## 🔹 Step 6: Clinic 엔티티 라인업

- ⚪ ClinicSlot 엔티티 teacherMemberId/branchId 필드 추가 및 레포지토리 보강
- ⚪ ClinicSession 엔티티 + Repository (slotId/date unique)
- ⚪ ClinicAttendance 엔티티 + Repository (clinicSessionId/studentCourseRecordId unique)
- ⚪ ClinicRecord 엔티티 + Repository (clinicAttendanceId unique, writerId 인덱스)

## 🔹 Step 7: Lesson 관련 수정

- ⚪ PersonalLesson 엔티티를 studentCourseRecordId + writerId 구조로 전환
- ⚪ SharedLesson 영향 범위 점검 및 필요한 필드 정비 (writerId naming 등)

## 🔹 Step 8: 기타 엔티티 (Invitation/Feedback/Notice/WorkLog)

- ⚪ Invitation 엔티티 branchId + targetEmail 필수 + inviteeRole=ASSISTANT only + `maxUses=1`
- ⚪ FeedbackStatus Enum + Feedback 엔티티/Repository
- ⚪ Notice/NoticeRead 스키마/Repository 보강 (Assignment 기반 권한 고려)
- ⚪ WorkLog 엔티티/Repository 보강 (assistantMemberId FK, hours 계산 규칙 명시)

## 🔹 Step 9: InitData 재정렬

- ⚪ Company/Branch/Member(+TeacherInfo/StudentInfo)/Assignment 순서로 InitData 재작성
- ⚪ Course/Enrollment/StudentCourseRecord/ClinicSlot/SharedLesson/PersonalLesson/Invitation InitData를 새 FK에 맞춰 업데이트
- ⚪ Seed 데이터 실행 스크립트 검증 (로컬 profile 기준)

---

# Phase 5. Season2 백엔드 서비스 & 컨트롤러

> 목표: 새 엔티티 기반으로 기능별 서비스/컨트롤러/테스트를 구현한다. 각 Epic은 PLAN 문서 작성 → 구현 → 테스트 순으로 진행한다.

## 🔹 Epic: Company/Branch 관리 + 배정 서비스

- ⚪ PLAN: `docs/plan/backend/season2/company-branch_service_plan.md` (권한/승인/검색 정의)
- ⚪ CompanyService/Controller (등록, 목록 검색, SuperAdmin 상태 변경) + 테스트
- ⚪ BranchService/Controller (OWNER가 생성/수정, isActive 토글) + 테스트
- ⚪ TeacherBranchAssignmentService (자동 할당 + 수동 전환 API) + Controller/테스트

## 🔹 Epic: Member 역할/초대/조교 배정

- ⚪ PLAN: `docs/plan/backend/season2/member-invitation_service_plan.md`
- ⚪ MemberService/AuthService 업데이트 (roles 기반 권한, TeacherInfo/StudentInfo CRUD 노출)
- ⚪ InvitationService/Controller 리팩터링 (email 단일 사용, 코드 소진 시 status=ACCEPTED)
- ⚪ TeacherAssistantAssignmentService (조교 연결/해제 API) + 관련 통합 테스트

## 🔹 Epic: 학생 등록 & 반별 기록 워크플로

- ⚪ PLAN: `docs/plan/backend/season2/student-enrollment_service_plan.md`
- ⚪ Public Course 검색 API (`/public/courses`) + 캐싱 전략 구현
- ⚪ StudentEnrollmentRequestService (학생 신청, 목록, Teacher/Assistant 승인/거절) + 자동 StudentCourseEnrollment/StudentCourseRecord 생성
- ⚪ StudentCourseRecordService (teacherNotes, defaultClinicSlot 설정, 비활성 처리) + Controller/테스트
- ⚪ Student/Teacher/Assistant용 수강 목록 API 정비 (`/students/me/courses`, `/courses/{id}/students`)

## 🔹 Epic: 클리닉 스케줄링 & 출석 관리

- ⚪ PLAN: `docs/plan/backend/season2/clinic-service_plan.md`
- ⚪ ClinicSlotService/Controller (CRUD + 권한 검증 + 중복 슬롯 방지)
- ⚪ 주간 ClinicSession 생성 배치 + 수동 세션 생성 API
- ⚪ 자동 ClinicAttendance 생성 로직 (defaultClinicSlot 기반) + 감사 로그 저장
- ⚪ 학생 전용 ClinicAttendance 변경 API (동일 주 내 이동) + Validation/테스트
- ⚪ ClinicRecordService/Controller (작성/조회/수정/삭제)

## 🔹 Epic: 커뮤니케이션 & 피드백 도메인

- ⚪ PLAN: `docs/plan/backend/season2/collaboration_service_plan.md`
- ⚪ Notice/NoticeRead 서비스 리팩터링 (신규 Assignment 구조 기반 권한)
- ⚪ WorkLogService/Controller (조교 CRUD, 선생님 조회, hours 자동 계산) + 테스트
- ⚪ FeedbackService/Controller (사용자 제출, SuperAdmin 처리) + 상태 전환 알림

## 🔹 Epic: 학생 캘린더 & 통합 조회 API

- ⚪ PLAN: `docs/plan/backend/season2/student-calendar_service_plan.md`
- ⚪ StudentCalendarQueryService 확장 (SharedLesson + PersonalLesson + ClinicEvents 통합, teacher/assistant/student 뷰 분리)
- ⚪ Clinic/lesson 이벤트 캐싱 전략 + 만료 정책 구현
- ⚪ Swagger/OpenAPI 문서 업데이트 (새 파라미터/응답 예시)

---

# Phase 6. 프런트엔드/UX 정비 (v1.3 흐름)

> 목표: 새 백엔드 기능에 맞춰 Next.js 프런트엔드를 전면 갱신하고 상태관리/권한 흐름을 최신화한다.

## 🔹 Epic: Teacher Workspace 업데이트

- ⚪ Company/Branch 관리 UI (등록, 검색, 승인 상태 표시)
- ⚪ TeacherBranchAssignment/초대 코드 화면 개편 (email 기반 단일 초대, 코드 상태 표시)
- ⚪ 반 생성 플로우에서 Company/Branch 선택 + 자동 배정 확인 UX

## 🔹 Epic: Student 경험 재구성

- ⚪ Public Course 검색 페이지 (필터, Paging, isActive 체크)
- ⚪ 반 등록 신청 폼 + 상태 조회(승인/거절)
- ⚪ 학생 대시보드: 수강 목록, 월간 캘린더(Shared/Personal/Clinic), ClinicAttendance 변경 UI

## 🔹 Epic: Assistant Workspace

- ⚪ 초대 가입 플로우 리뉴얼 (코드 1회 사용, branch context 안내)
- ⚪ 클리닉 관리 화면: Slot 일정, Session 목록, Attendance 체크, ClinicRecord 작성
- ⚪ WorkLog 작성/수정 페이지 + 선생님 공유 뷰

## 🔹 Epic: SuperAdmin & Ops UI

- ⚪ Company 검증 화면 (status 전환 + rejectionReason)
- ⚪ Feedback 처리 콘솔 (필터링, 상태 변경)
- ⚪ 시스템 상태 위젯 (주요 배치 성공/실패 표시)

## 🔹 Epic: 공통 UI/State 정리

- ⚪ Auth context를 다중 roles 구조로 업데이트
- ⚪ 공통 Date/Week picker 컴포넌트 (Clinic/Calendar 공유)
- ⚪ API 에러/로딩 표준화 + Toast/모달 통합

---

# Phase 7. 시나리오 검증 & 테스트 자동화

> 목표: 역할별 핵심 플로우를 재현하고 자동화·배치 안정성을 검증한다. 각 Epic은 PLAN 문서를 먼저 작성(예: `docs/plan/qa/teacher-e2e_plan.md`)한 뒤 수행한다.

## 🔹 Epic: 선생님 통합 시나리오 QA

- ⚪ PLAN: `docs/plan/qa/teacher-e2e_plan.md`
- ⚪ 시나리오 정의: Company 등록 → Branch 생성 → Course 생성 → 학생 등록 승인 → Shared/PersonalLesson 작성 → 클리닉 운영 → Notice 발송
- ⚪ 시뮬레이션 데이터/Fixture 구성 (MySQL seed or Testcontainers)
- ⚪ 수동 검증 체크리스트 작성 및 실행
- ⚪ Playwright/Cypress 등 자동화 스크립트 작성 (교사용 뷰 중심)

## 🔹 Epic: 조교 통합 시나리오 QA

- ⚪ PLAN: `docs/plan/qa/assistant-e2e_plan.md`
- ⚪ 시나리오 정의: 초대 코드 수락 → TeacherAssistantAssignment 확인 → ClinicSlot/Session 일정 확인 → Attendance 처리 → ClinicRecord 작성 → WorkLog 제출
- ⚪ 권한/에러 케이스(접근 차단, 만료 초대 등) 검증
- ⚪ UI 자동화 스크립트 + API 통합 테스트 작성

## 🔹 Epic: 학생 통합 시나리오 QA

- ⚪ PLAN: `docs/plan/qa/student-e2e_plan.md`
- ⚪ 시나리오 정의: 공개 Course 검색 → EnrollmentRequest 생성 → 상태 조회 → 승인 후 캘린더/클리닉 안내 확인 → ClinicAttendance 변경
- ⚪ 모바일/데스크톱 뷰 검증 및 접근성 체크
- ⚪ 실패 케이스(중복 신청, 마감 이후 변경 등) 테스트

## 🔹 Epic: E2E 자동화 파이프라인

- ⚪ PLAN: `docs/plan/qa/e2e-pipeline_plan.md`
- ⚪ Playwright(or Cypress) 테스트 러너 표준화, 공통 헬퍼 작성
- ⚪ GitHub Actions 워크플로우에 E2E 단계 추가 (브랜치별 선택 실행)
- ⚪ 테스트 데이터 초기화/시드 전략 수립 및 문서화

## 🔹 Epic: 배치/스케줄러 안정성

- ⚪ PLAN: `docs/plan/qa/scheduler-validation_plan.md`
- ⚪ ClinicSession/Attendance 주간 배치 모니터링 + 재시도 전략 정의
- ⚪ Invitation 만료 처리 스케줄러 검증 (ASSISTANT 코드 정리)
- ⚪ Scheduler/배치 단위 테스트 + 통합 테스트 + 장애 대응 절차 마련

## 🔹 Epic: QA 결과 문서화 & 운영 체크리스트

- ⚪ PLAN: `docs/plan/qa/ops-checklist_plan.md`
- ⚪ API 문서/Swagger 정리 (권한/예제/오류 코드 최신화)
- ⚪ 역할별 수동 검증 체크리스트 업데이트 (Teacher/Assistant/Student)
- ⚪ 운영 배포 체크리스트 v1.3 (도메인, DNS, Refresh 쿠키, 배치 스케줄) 작성 및 공유

---

# Phase 8. 릴리스 준비 & 피드백 루프

## 🔹 Epic: 베타 릴리스 준비

- ⚪ 역할별 기능 QA 완료 보고
- ⚪ 성능 테스트 (50명 동시 접속 + Clinic 배치 부하)
- ⚪ 보안 점검 (JWT 만료/재발급, 권한 우회 시나리오, HTTPS)
- ⚪ 프로덕션 배포 자동화 검증 (Docker Compose + GitHub Actions)

## 🔹 Epic: 모니터링/운영 채널

- ⚪ 모니터링 대시보드 (CPU/메모리/디스크, API Latency, 배치 성공률)
- ⚪ 에러 알림 채널 (Slack or Email) 세팅
- ⚪ 사용자 행동 로깅(주요 버튼/신청 이벤트) 설계

## 🔹 Epic: 사용자 피드백 수집 및 개선

- ⚪ 베타 사용자 온보딩 + 인터뷰 스크립트
- ⚪ 피드백 triage 프로세스 (연결된 GitHub Issues)
- ⚪ 릴리스 노트/데모 자료/가격 정책 초안 작성
