# 프로젝트 구상 v1.3

# 1. 문제 정의 및 목표 설정

## 📘 프로젝트 개요

- **프로젝트명:** ClassHub (임시명)
- **목표:** 학원 강사들이 여러 학원과 지점에서 수업, 학생, 조교를 통합 관리하고 커뮤니케이션을 효율화하는 플랫폼을 구축한다.

## 💡 배경 및 필요성

- **기존 방식(노션, 엑셀)의 문제점**
  - 공지사항 전달을 위해 카카오톡 등으로 반복적으로 공유해야 함
  - 수업 현황 및 학생별 진도 관리의 체계 부족
  - 클리닉 출석 체크 누락, 기록 관리 어려움 → 결석자 관리 힘듬
  - 노션 페이지가 많아질 경우 비용 부담 발생
  - **여러 학원에서 일하는 강사의 경우 각 학원별로 별도 관리 필요**
- **시장조사**
  - 현재 학원 강사용 일정·조교 관리 전용 통합 서비스는 부재함
  - 기존 노션, 구글폼, 엑셀 등을 임시 대체로 사용하는 수준
  - **멀티 학원/지점 관리 기능을 제공하는 서비스 없음**

---

# 2. 요구사항 분석

## (1) 사용자 정의

- **SuperAdmin** (슈퍼 관리자)
- **Teacher** (선생님)
- **Assistant** (조교)
- **Student** (학생)

**비고:**

- MemberRole에는 ADMIN도 정의되어 있으나, 현재는 SuperAdmin만 사용
- Admin은 향후 중간 관리자 역할이 필요할 때 사용 예정

## (2) Use Case

### 🧑‍💻 SuperAdmin

- **전체 권한 보유**
- **Company/Branch 검증 관리**:
  - 선생님이 등록한 Company/Branch를 확인해 `verifiedStatus`를 VERIFIED로 전환 (UNVERIFIED → VERIFIED)
  - 검증 전에는 생성자만 접근 가능하며, VERIFIED 이후 전제 Teacher가 검색/사용 가능
- **Feedback 관리**:
  - 사용자 피드백 조회, 상태 변경 (SUBMITTED → RESOLVED)
  - 피드백 삭제

### 👩‍🏫 Teacher (선생님)

#### Company/Branch 관리

- **출강 학원 등록**: 개인/회사 학원을 선택해 Company/Branch를 등록한다. 자세한 흐름은 아래와 같다.
  - **개인 학원(INDIVIDUAL)**: company.name을 직접 입력하면 Company + Branch가 동시에 생성되고 둘 다 `verifiedStatus=VERIFIED`가 된다. Branch는 1개만 허용되며, TeacherBranchAssignment는 OWNER로 생성된다.
  - **회사 학원(ACADEMY)**: 기본적으로 `verifiedStatus=VERIFIED`인 Company/Branch 목록에서 선택한다. 존재하지 않으면 회사/지점을 직접 입력해 `verifiedStatus=UNVERIFIED`로 임시 생성하고, Assignment는 FREELANCE로 만든다. SuperAdmin 검증 이후 VERIFIED로 승격된다.
- **Branch 관리**: 소속 Branch 조회, 본인이 OWNER인 경우 Branch 생성/수정

#### 수업 관리

- **Course CRUD**: 반 생성, 조회, 수정, 활성화, 비활성화 (branchId 필수)
- **CourseProgress CRUD**: 반별 공통진도 작성, 조회, 수정, 삭제
- **PersonalProgress CRUD**: 학생별 개별진도 작성, 조회, 수정, 삭제

#### 학생 관리

- **StudentEnrollmentRequest 승인**: 학생의 반 등록 신청 승인/거부
- **StudentCourseRecord 관리**: 반별 학생 기록 조회, 담당 조교 지정/변경, `teacherNotes`, `defaultClinicSlotId` 수정
- **학생 목록 조회**: 본인 반의 등록한 학생 목록
- **학생 캘린더 조회**: 학생별 공통진도 + 개별진도 + 클리닉 기록 통합 뷰

#### 조교 관리

- **조교 배정**: 이미 가입한 Assistant를 이메일로 검색 후 직접 배정
  - TeacherAssistantAssignment 생성/활성화/비활성화
- **Notice CRUD**: 조교 전용 공지사항 작성, 조회, 수정, 삭제
  - NoticeRead를 통해 조교별 읽음 여부 확인
- **WorkLog 조회**: 조교들의 근무일지 조회

#### 클리닉 관리

- **ClinicSlot CRUD**: 반별 클리닉 시간표 작성, 조회, 수정, 활성화, 비활성화
  - 요일별 반복 시간표 설정 (dayOfWeek, startTime, endTime, defaultCapacity)
  - 각 반(Course)별로 여러 클리닉 슬롯 생성 가능
  - creatorMemberId 자동 기록 (생성자 추적)
- **ClinicSession 관리**: 특정 날짜의 클리닉 세션 조회, 취소
  - **정규 세션 (REGULAR)**: 매주 일요일 자정에 해당 주차(월~일) 세션 자동 생성
  - **긴급 세션 (EMERGENCY)**: 급한 경우 수동으로 세션 생성 (slotId 없이, creatorMemberId 기록)
  - 세션별 capacity 조정 가능 (정규 세션은 defaultCapacity 기본값 사용)
  - 세션 시작 10분 전에 ClinicAttendance 목록 확정 및 출석명단 제공
- **ClinicAttendance 관리**: 세션별 학생 출석 조회
  - 학생의 defaultClinicSlotId 기반으로 자동 생성 (REGULAR 세션)
  - 긴급 세션은 수동으로 학생 추가
  - 학생의 추가 신청/이동 요청 처리
- **StudentCourseRecord 관리**: 학생의 defaultClinicSlotId 설정/변경
  - 학생 요청 시 고정 클리닉 슬롯 변경
- **ClinicRecord CRUD**: 출석한 학생들의 클리닉 기록 작성, 조회, 수정, 삭제
  - ClinicAttendance별 1:1 기록 작성

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출

### 🧑‍💼 Assistant (조교)

#### 학생/클리닉 관리

- **ClinicSession 조회 및 생성**:
  - 오늘 또는 특정 날짜의 클리닉 세션 확인
  - **긴급 세션 생성**: 급한 경우 즉시 ClinicSession 생성 (EMERGENCY 타입, creatorMemberId 기록)
  - 세션 시작 10분 전에 ClinicAttendance 목록 확정 및 출석명단 제공
- **ClinicRecord CRUD**: 출석한 학생들의 클리닉 기록 작성, 조회, 수정, 삭제
  - ClinicAttendance별 1:1 기록 작성
- **담당 학생 목록 관리**: Teacher가 배정한 StudentCourseRecord를 조회하고 학생별 진행 상황/메모를 업데이트

#### 근무 관리

- **WorkLog CRUD**: 근무일지 작성, 조회, 수정, 삭제
  - date, startTime, endTime, hours(자동 계산), memo

#### 공지사항

- **Notice 조회**: 선생님이 작성한 공지사항 조회
- **NoticeRead 생성**: 공지사항 읽음 처리

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출

### 🧑‍🎓 Student (학생)

#### 반 등록

- **Course 검색**: 공개된 반 목록 조회 (학원명, 반명, 선생님 이름, 수업 이름 검색)
- **StudentEnrollmentRequest 생성**: 반 등록 신청 (message 작성 가능)
- **본인 수강 목록 조회**: 승인된 Course 목록 확인

#### 클리닉

- **ClinicSlot 조회 및 선택**: 본인이 수강하는 반의 클리닉 시간표 확인
  - 각 반(Course)별로 선생님이 개설한 클리닉 시간표 목록 조회
  - 초기 등록 시 고정 클리닉 슬롯 선택 (defaultClinicSlotId 설정)
  - 선택 후에는 학생이 직접 변경 불가 (악용 방지)
  - 변경이 필요한 경우 선생님에게 요청
- **주차별 ClinicAttendance 이동**: 해당 주차 내 다른 날짜로 변경
  - 매주 일요일 자정에 해당 주차(월~일) ClinicSession 자동 생성
  - 세션 시작 30분 전까지 같은 주 내 다른 날짜로 이동 가능
  - 횟수 제한 없음 (같은 주 내에서만)
- **ClinicAttendance 추가 신청**: 특정 날짜에 클리닉 추가 참석 신청
  - 승인 없이 바로 참석 신청 가능
  - 횟수 제한 없음 (최소 주1회 보장)

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출

---

## (3) 사용자 흐름 (User Flow)

### 👨‍💼 SuperAdmin

- 시스템에서 직접 생성 (DB seed 또는 관리자 명령)

### 👩‍🏫 Teacher

1. **선생님 회원가입**: email, password, name, phoneNumber 입력
   - 자동으로 TEACHER role 부여 (단일 역할)
2. **출강 학원 등록**:
   - **개인 학원**: company.name을 입력하면 Company + Branch가 동시에 생성되고 둘 다 `verifiedStatus=VERIFIED`로 저장된다(Branch 1개, Assignment=OWNER).
   - **회사 학원**: 기본적으로 VERIFIED Company/Branch 목록에서 선택한다. 존재하지 않으면 회사/지점 정보를 직접 입력해 `verifiedStatus=UNVERIFIED`로 임시 생성하고 Assignment=FREELANCE로 만든다.
3. **Branch 선택/생성**:
   - Company에 속한 Branch를 선택하거나 직접 생성한 Branch를 사용한다.
   - OWNER인 경우 Branch 정보를 수정할 수 있다.
4. **반 생성**: branchId와 함께 Course 생성
   - TeacherBranchAssignment 자동 생성 (role: OWNER/FREELANCE)
   - 기존 회사 명단에 없는 경우 OWNER, 있는 경우 FREELANCE
5. **메인 대시보드**: 반 목록, 학생 현황, 클리닉 일정, 조교 근무 현황 확인 (추후 확정)

### 🧑‍💼 Assistant

1. **일반 회원가입**: email, password, name, phoneNumber 입력
   - 자동으로 ASSISTANT role 부여 (단일 역할)
2. **Teacher 연결 대기**: Teacher가 이메일로 검색 후 배정할 때까지 대기
   - Teacher가 TeacherAssistantAssignment 생성 시 연결 완료
3. **메인 화면**: 클리닉 관리 중심 UI

### 🧑‍🎓 Student

1. **자유 가입**: email, password, name, phoneNumber 입력
   - 자동으로 STUDENT role 부여 (단일 역할)
   - StudentInfo 생성 (schoolName, grade, birthDate, parentPhone 입력 필수)
2. **반 검색**: 공개된 Course 목록에서 검색 (회사별, 지점별, 선생님 이름 필터)
3. **반 등록 신청**: StudentEnrollmentRequest 생성
4. **승인 대기**: Teacher 또는 연결된 Assistant가 승인/거절
   - processedByMemberId, processedAt 기록
5. **승인 후**:
   - StudentCourseEnrollment 생성 (enrolledAt 기록)
   - StudentCourseRecord 생성 (반별 학생 기록, teacherNotes)
6. **고정 클리닉 슬롯 선택**:
   - 각 반의 ClinicSlot 목록 조회
   - 학생이 고정 클리닉 슬롯 선택 (defaultClinicSlotId 설정)
   - 선택 후에는 변경 불가 (선생님에게 요청 필요)
7. **주차별 클리닉 참석**:
   - 매주 일요일 자정에 defaultClinicSlotId 기반 ClinicAttendance 자동 생성
   - 세션 시작 30분 전까지 같은 주 내 다른 날짜로 이동 가능
   - 추가 클리닉 참석 신청 가능 (승인 없이)
8. **메인 화면**: 본인 수강 목록, 캘린더, 클리닉 시간표

---

## (4) 기능 요구 정의 방식

- 상세 기능 요구사항(FR)은 Phase별 TODO를 진행하면서 각 작업의 PLAN 문서에서 정의한다.
- Requirement 문서는 사용자/Use Case/흐름/비기능 기준만 유지하며, 구현 세부사항은 `docs/plan/<feature>_plan.md`에 기록 후 스펙/ TODO로 반영한다.
- 기능 추가나 변경이 필요하면 **반드시** requirement → spec → TODO 순으로 버전을 올린다.

---

## (5) 비기능 요구사항

| 분류                     | 요구사항                                            |
| ------------------------ | --------------------------------------------------- |
| **보안(Security)**       | JWT 기반 인증 / Role 기반 접근제어 / HTTPS 통신     |
| **성능(Performance)**    | 평균 응답속도 1초 이하, 50명 동시접속 기준          |
| **확장성(Scalability)**  | 사용자 및 데이터 증가 시 수평 확장 가능 구조        |
| **가용성(Availability)** | Docker 기반 컨테이너 배포, 장애 시 5분 내 복구 목표 |
| **데이터(Data)**         | MySQL 사용, Redis 캐싱으로 조회 속도 향상           |
| **UI/UX**                | 반응형 웹 지원 (PC/Tablet/Mobile)                   |
| **운영(Ops)**            | CI/CD 구축 (GitHub Actions → Docker → AWS EC2 배포) |

---

# 3. 설계 및 기획

## (1) 🧩 기술 스택

| **구분**                    | **기술**                                                             | **비고**                            |
| --------------------------- | -------------------------------------------------------------------- | ----------------------------------- |
| **Frontend**                | Next.js 16, React 19, Tailwind CSS 4                                 | 대시보드 UI, 반응형 인터페이스      |
| **Backend**                 | Spring Boot 4.0.0, Java 21, Spring Security, JWT                     | REST API 서버, 인증/인가 적용       |
| **Database / Cache**        | MySQL 8.4, Redis 7.4                                                 | 영속 데이터 저장 + 캐싱/세션        |
| **Infra**                   | AWS EC2, Docker, Docker Compose, GitHub Actions, Nginx Proxy Manager | CI/CD 자동 배포, Reverse Proxy 구성 |
| **Documentation / Testing** | SpringDoc OpenAPI, JUnit5, MockMvc                                   | API 문서화 및 테스트 자동화         |

## (2) 🖥️ 화면 설계 (Wireframe)

- [Google Slides 와이어프레임 보기](https://docs.google.com/presentation/d/1BrebNS9Lt8r_QTi6k4YosUah6AURUIMa8cncMejZBLs/edit?usp=sharing)
- **선생님 메인 페이지:** 대시보드 중심 (클래스, 출결, 조교 근무상황 위젯 구성)
- **조교 메인 페이지:** 클리닉 관리 중심 UI
- **학생 메인 페이지:** 캘린더 + 수강 목록 중심 UI

## (3) 도메인 설계

### 주요 엔티티 (v1.3 기준)

| 엔티티                         | 설명                                                                           |
| ------------------------------ | ------------------------------------------------------------------------------ |
| **Company**                    | 학원/회사 정보 (type: INDIVIDUAL/ACADEMY, verifiedStatus: UNVERIFIED/VERIFIED, Soft Delete)         |
| **Branch**                     | 학원 지점 정보 (creatorMemberId, verifiedStatus: UNVERIFIED/VERIFIED, Soft Delete)                  |
| **Member**                     | 사용자 엔티티 (단일 역할: Teacher/Assistant/Student/Admin/SuperAdmin, Soft Delete)                  |
| **StudentInfo**                | 학생 추가 정보 (학교명, grade enum, 생년월일, 학부모 연락처)                                         |
| **TeacherBranchAssignment**    | 선생님-지점 배정 (M:N 관계, role: OWNER/FREELANCE, Soft Delete)                                     |
| **TeacherAssistantAssignment** | 선생님-조교 배정 (M:N 관계, Soft Delete)                                                            |
| **Course**                     | 반 정보 (Teacher가 특정 Branch에 생성, schedules: ElementCollection, Soft Delete)                   |
| **StudentEnrollmentRequest**   | 학생의 반 등록 신청 (PENDING/APPROVED/REJECTED, processedByMemberId)                                |
| **StudentCourseEnrollment**    | 학생-반 등록 완료 기록 (M:N 관계, enrolledAt)                                                       |
| **StudentCourseRecord**        | 반별 학생 기록 (teacherNotes, defaultClinicSlotId, assistantMemberId, Soft Delete)                  |
| **CourseProgress**             | 반 공통 진도 (Course 삭제 시 CASCADE)                                                               |
| **PersonalProgress**           | 학생별 개별 진도 (실제 DELETE 허용)                                                                 |
| **ClinicSlot**                 | 클리닉 시간표 (요일별 반복, defaultCapacity, creatorMemberId, Soft Delete)                          |
| **ClinicSession**              | 특정 날짜의 실제 클리닉 세션 (sessionType: REGULAR/EMERGENCY, capacity, creatorMemberId, isCanceled) |
| **ClinicAttendance**           | 클리닉 세션 참석 학생 목록 (실제 DELETE 허용)                                                       |
| **ClinicRecord**               | 클리닉 실시 기록 (선생님/조교 작성, 실제 DELETE 허용)                                               |
| **Notice**                     | 선생님이 조교에게 전달하는 공지사항 (실제 DELETE 허용)                                              |
| **NoticeRead**                 | 조교의 공지사항 읽음 처리 (readAt, 실제 DELETE 허용)                                                |
| **WorkLog**                    | 조교 근무 일지 (hours 자동 계산, 실제 DELETE 허용)                                                  |
| **Feedback**                   | 사용자 피드백 (SUBMITTED/RESOLVED, 실제 DELETE 허용)                                                |

### 관계 (v1.3 기준)

| **관계**                                     | **설명**                               |
| -------------------------------------------- | -------------------------------------- |
| Company 1:N Branch                           | 학원은 여러 지점 보유                  |
| Branch 1:N Course                            | 지점은 여러 반 보유                    |
| Member(TEACHER) ↔ Branch (M:N)              | TeacherBranchAssignment 중간 테이블    |
| Member(TEACHER) ↔ Member(ASSISTANT) (M:N)   | TeacherAssistantAssignment 중간 테이블 |
| Member(STUDENT) ↔ Course (M:N)              | StudentCourseEnrollment 중간 테이블    |
| Member ↔ StudentInfo (1:1)                  | 학생 추가 정보                         |
| Member(STUDENT) 1:N StudentEnrollmentRequest | 학생이 반 등록 신청                    |
| Course 1:N StudentEnrollmentRequest          | 반이 여러 등록 신청 받음               |
| StudentCourseRecord 1:N PersonalProgress     | 반별 학생 기록에 개별 진도 포함        |
| Course 1:N CourseProgress                    | 반에 공통진도 작성 (CASCADE 삭제)      |
| Course 1:N ClinicSlot                        | 반별 클리닉 시간표                     |
| Member(TEACHER) 1:N ClinicSlot (teacherMemberId) | 선생님이 클리닉 담당                  |
| Member 1:N ClinicSlot (creatorMemberId)      | 선생님/조교가 클리닉 시간표 생성       |
| Branch 1:N ClinicSlot                        | 지점별 클리닉 시간표                   |
| ClinicSlot 1:N ClinicSession (REGULAR)       | 시간표 기반 정규 세션 자동 생성        |
| Member 1:N ClinicSession (EMERGENCY)         | 선생님/조교가 긴급 세션 수동 생성      |
| ClinicSession 1:N ClinicAttendance           | 세션별 학생 출석 기록                  |
| StudentCourseRecord 1:N ClinicAttendance     | 반별 학생 기록 기준 출석               |
| ClinicAttendance 1:1 ClinicRecord            | 출석 학생마다 클리닉 기록 작성         |
| Member(TEACHER) 1:N Notice                   | 선생님이 공지사항 작성                 |
| Notice 1:N NoticeRead                        | 조교별 읽음 처리                       |
| Member(ASSISTANT) 1:N StudentCourseRecord    | 조교가 담당 학생 배정                  |
| Member(ASSISTANT) 1:N WorkLog                | 조교가 근무일지 작성                   |
| Member 1:N Feedback                          | 사용자가 피드백 작성                   |

---

## (4) 주요 변경사항 (v1.2 → v1.3)

### 엔티티 추가/갱신

- **BaseEntity**: deletedAt (LocalDateTime) 추가로 Soft Delete 전략 변경 (isActive → deletedAt)
- **Company, Branch**: VerifiedStatus(UNVERIFIED/VERIFIED) 도입 + Branch.creatorMemberId/Assignment 역할 규칙 추가 + Soft Delete
- **StudentInfo**: Member와 역할별 정보 분리 + Grade Enum(초1~고3, GAP_YEAR) 도입
- **TeacherBranchAssignment, TeacherAssistantAssignment**: M:N 배정 관계 + Soft Delete
- **StudentEnrollmentRequest**: 학생 자유 가입 + 반 등록 신청 프로세스 (processedByMemberId 추가)
- **StudentCourseRecord**: StudentProfile에서 네이밍 변경 및 구조 개선 + Soft Delete
- **ClinicSlot**: creatorMemberId 추가 (생성자 추적), capacity → defaultCapacity 변경 + Soft Delete
- **ClinicSession**: sessionType (REGULAR/EMERGENCY) 추가, slotId nullable 변경, creatorMemberId/capacity 추가 (긴급 세션 지원)
- **ClinicAttendance, ClinicRecord**: 클리닉 구조 상세화
- **Notice, NoticeRead**: 공지사항 시스템
- **WorkLog**: 조교 근무일지
- **Feedback**: 사용자 피드백 시스템

### 사용자 흐름 변경

- **Teacher**: Company 등록/선택 단계 추가, 조교 직접 배정 방식으로 변경
- **Student**: 초대 방식 제거 → 자유 가입 + 반 등록 신청 방식으로 변경
- **Assistant**: 초대 방식 제거 → 일반 회원가입 + Teacher 배정 대기 방식으로 변경

### Use Case 변경

- **Teacher**: Company/Branch 관리, StudentEnrollmentRequest 승인 추가 (role: OWNER/FREELANCE), 조교 이메일 검색 후 직접 배정
- **Assistant**: 학생 초대 제거, 일반 회원가입 후 Teacher 배정 대기
- **Student**: 반 검색, 반 등록 신청, ClinicSession 변경/추가, 본인 진도 조회 추가
- **SuperAdmin**: Company 검증 (UNVERIFIED → VERIFIED), Feedback 관리 추가

### 데이터 모델 개선

- **Member.role**: 단일 역할 (List에서 단일 값으로 변경)
- **Member.phoneNumber**: unique 제거 (학부모 번호 중복 가능)
- **TeacherBranchAssignment.role**: OWNER/FREELANCE만 (MANAGER/EMPLOYEE 제거)
- **TeacherAssistantAssignment**: Soft delete로 활성/비활성 관리
- **CourseProgress**: SharedLesson에서 네이밍 변경, Course 삭제 시 CASCADE 적용
- **PersonalProgress**: PersonalLesson에서 네이밍 변경
- **ClinicSlot**: courseId 추가 (반별 클리닉 시간표)

### 클리닉 프로세스 상세화

1. **ClinicSlot 생성** (Teacher):

   - 반(Course)별로 클리닉 시간표 생성 (요일, 시간, 정원)
   - 한 반에 여러 클리닉 슬롯 생성 가능 (예: 월수금 14:00, 화목 15:00)

2. **고정 클리닉 선택** (Student):

   - 반 등록 승인 후 고정 클리닉 슬롯 선택 (defaultClinicSlotId)
   - 선택 후 학생이 직접 변경 불가 (악용 방지)
   - 변경 필요 시 선생님에게 요청

3. **주차별 세션 자동 생성** (REGULAR 타입):

   - 매주 일요일 자정에 해당 주차(월~일) ClinicSession 자동 생성
   - sessionType = REGULAR, slotId 자동 설정
   - ClinicSlot의 defaultCapacity를 Session의 capacity로 복사
   - defaultClinicSlotId 기반으로 ClinicAttendance 자동 생성

4. **긴급 세션 수동 생성** (EMERGENCY 타입):

   - 선생님 또는 조교가 필요 시 즉시 ClinicSession 생성
   - sessionType = EMERGENCY, slotId = null, creatorMemberId 기록
   - 특정 날짜/시간/정원을 즉석에서 설정 가능
   - ClinicAttendance는 수동 추가

5. **학생의 유연한 일정 조정**:

   - 세션 시작 30분 전까지 같은 주 내 다른 날짜로 이동 가능 (횟수 제한 없음)
   - 추가 클리닉 참석 신청 가능 (승인 없이, 횟수 제한 없음)
   - 최소 주1회 보장

6. **출석명단 확정 및 기록**:
   - 세션 시작 10분 전에 ClinicAttendance 목록 확정
   - 선생님/조교에게 출석명단 제공
   - ClinicAttendance별 1:1 ClinicRecord 작성

---
