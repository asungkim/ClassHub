# 프로젝트 구상 v1.5

# 1. 문제 정의 및 목표 설정

## 📘 프로젝트 개요

- **프로젝트명:** ClassHub (임시명)
- **목표:** 학원 강사가 여러 학원·지점, 학생, 조교를 통합 관리하고 커뮤니케이션을 효율화하는 플랫폼을 구축한다.

## 💡 배경 및 필요성

- **기존 방식(노션, 엑셀)의 문제점**
  - 공지사항 전달을 위해 카카오톡 등으로 반복적으로 공유해야 함
  - 수업 현황 및 학생별 진도 관리의 체계 부족
  - 클리닉 출석 체크 누락, 기록 관리 어려움 → 결석자 관리 힘듬
  - 노션 페이지가 많아질 경우 비용 부담 발생
  - **여러 학원에서 일하는 강사의 경우 각 학원별로 별도 관리 필요**
- **시장조사**
  - 현재 학원 강사용 일정·조교 관리 전용 통합 서비스는 부재함
  - 기존 노션, 구글폼, 엑셀 등을 임시 대체로 사용하는 수준
  - **멀티 학원/지점 관리 기능을 제공하는 서비스 없음**

---

# 2. 요구사항 분석

## (1) 사용자 정의

- **SuperAdmin** (슈퍼 관리자)
- **Teacher** (선생님)
- **Assistant** (조교)
- **Student** (학생)

**비고:**

- MemberRole에는 ADMIN도 정의되어 있으나, 현재는 SuperAdmin만 사용
- Admin은 향후 중간 관리자 역할이 필요할 때 사용 예정

## (2) Use Case

### ✅ 공통 (모든 사용자)

- **내 정보 조회/수정**:
  - Teacher/Assistant는 Member 정보만 조회
  - Student는 Member + StudentInfo 정보를 함께 조회
  - Member 기본 정보(이메일/이름/전화번호/비밀번호) 및 StudentInfo(학생만) 수정 가능
- **임시 비밀번호 즉시 발급**:
  - 이메일 + 핸드폰 입력으로 본인 확인 후 임시 비밀번호 발급
  - 화면에 `임시 비밀번호: Classmate1234!` 형태로 표시
  - 임시 비밀번호로 로그인 후 새 비밀번호로 변경하도록 유도

### 🧑‍💻 SuperAdmin

- **전체 권한 보유**
- **Company/Branch 검증 관리**:
  - 선생님이 등록한 Company/Branch를 확인해 `verifiedStatus`를 VERIFIED로 전환 (UNVERIFIED → VERIFIED)
  - 검증 전에는 생성자만 접근 가능하며, VERIFIED 이후 전제 Teacher가 검색/사용 가능
- **Feedback 관리**:
  - 사용자 피드백 조회, 상태 변경 (SUBMITTED → RESOLVED)
  - 상태 변경 시 작성자 대시보드에서 해결됨 상태 확인 가능
  - 피드백 삭제

### 👩‍🏫 Teacher (선생님)

#### Company/Branch 관리

- **출강 학원 등록**: 개인/회사 학원을 선택해 Company/Branch를 등록한다. 자세한 흐름은 아래와 같다.
  - **개인 학원(INDIVIDUAL)**: company.name을 직접 입력하면 Company + Branch가 동시에 생성되고 둘 다 `verifiedStatus=VERIFIED`가 된다. Branch는 1개만 허용되며, TeacherBranchAssignment는 OWNER로 생성된다.
  - **회사 학원(ACADEMY)**: 기본적으로 `verifiedStatus=VERIFIED`인 Company/Branch 목록에서 선택한다. 존재하지 않으면 회사/지점을 직접 입력해 `verifiedStatus=UNVERIFIED`로 임시 생성하고, Assignment는 FREELANCE로 만든다. SuperAdmin 검증 이후 VERIFIED로 승격된다.
- **Branch 관리**: 소속 Branch 조회, 본인이 OWNER인 경우 Branch 생성/수정

#### 학생/반 관리

- **학생 연결 요청 처리**: 학생의 등록 요청(Student → Teacher)을 승인/거절한다.
  - 승인 시 TeacherStudentAssignment 생성
- **학생 목록 조회**: 연결된 모든 학생을 조회하며, 반으로 필터링한다.
- **반 배치/해제**: 반 생성 후 연결된 학생을 배치한다.
  - 배치 시 StudentCourseAssignment 생성
  - 휴원/재원은 StudentCourseAssignment on/off로 관리
- **학생 기록 관리**: StudentCourseRecord의 `teacherNotes`, 담당 조교, 기본 클리닉 슬롯을 관리한다.

#### 수업 관리

- **Course CRUD**: 반 생성, 조회, 수정, 활성화, 비활성화 (branchId 필수)
- **CourseProgress CRUD**: 반별 공통진도 작성, 조회, 수정, 삭제
- **PersonalProgress CRUD**: 학생별 개별진도 작성, 조회, 수정, 삭제

#### 조교 관리

- **조교 배정**: 이미 가입한 Assistant를 이메일로 검색 후 직접 배정
  - TeacherAssistantAssignment 생성/활성화/비활성화
- **Notice CRUD**: 조교 전용 공지사항 작성, 조회, 수정, 삭제
  - NoticeRead를 통해 조교별 읽음 여부 확인
- **WorkLog 조회**: 조교들의 근무일지 조회

#### 클리닉 관리

- **ClinicSlot CRUD**: 선생님/지점 기준 클리닉 시간표 작성, 조회, 수정, 활성화, 비활성화
  - 요일별 반복 시간표 설정 (dayOfWeek, startTime, endTime, defaultCapacity)
  - 동일 teacher + branch의 Course 학생들은 동일 슬롯 목록을 공유
  - creatorMemberId 자동 기록 (생성자 추적)
- **ClinicSession 관리**: 특정 날짜의 클리닉 세션 조회, 취소
  - **정규 세션 (REGULAR)**: 매주 일요일 자정에 해당 주차(월~일) 세션 자동 생성
  - **긴급 세션 (EMERGENCY)**: 급한 경우 날짜/시간 직접 입력해 세션 생성 (slotId 없이, creatorMemberId 기록)
  - 세션별 capacity 조정 가능 (정규 세션은 defaultCapacity 기본값 사용)
  - 세션 시작 10분 전에 ClinicAttendance 목록 확정 및 출석명단 제공
  - 취소 시 isCanceled 처리 (Attendance 기록은 유지)
- **ClinicAttendance 관리**: 세션별 학생 출석 조회
  - StudentCourseAssignment가 활성인 학생만 자동 배정 대상
  - 긴급 세션은 수동으로 학생 추가
  - 학생의 추가 신청/이동 요청 처리 (예외 상황에서 수동 추가/삭제)
- **ClinicRecord CRUD**: 출석한 학생들의 클리닉 기록 작성, 조회, 수정, 삭제
  - ClinicAttendance별 1:1 기록 작성

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출
- **Feedback 해결 상태 확인**: 대시보드에서 본인이 제출한 피드백의 해결 여부 확인

### 🧑‍💼 Assistant (조교)

#### 학생/클리닉 관리

- **ClinicSession 조회 및 생성**:
  - 오늘 또는 특정 날짜의 클리닉 세션 확인
  - **긴급 세션 생성**: 급한 경우 즉시 ClinicSession 생성 (EMERGENCY 타입, creatorMemberId 기록)
  - **세션 취소**: 일정 취소 (isCanceled 처리, Attendance 기록 유지)
  - 세션 시작 10분 전에 ClinicAttendance 목록 확정 및 출석명단 제공
- **ClinicRecord CRUD**: 출석한 학생들의 클리닉 기록 작성, 조회, 수정, 삭제
  - ClinicAttendance별 1:1 기록 작성
- **담당 학생 목록 관리**: Teacher가 배정한 StudentCourseRecord를 조회하고 학생별 진행 상황/메모를 업데이트

#### 근무 관리

- **WorkLog CRUD**: 근무일지 작성, 조회, 수정, 삭제
  - date, startTime, endTime, hours(자동 계산), memo

#### 공지사항

- **Notice 조회**: 선생님이 작성한 공지사항 조회
- **NoticeRead 생성**: 공지사항 읽음 처리

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출
- **Feedback 해결 상태 확인**: 대시보드에서 본인이 제출한 피드백의 해결 여부 확인

### 🧑‍🎓 Student (학생)

#### 선생님 연결

- **선생님 검색**: 선생님 이름 검색 + 학원/지점 필터
  - 검색 결과에는 선생님 이름과 출강 지점 정보만 표시
- **Teacher 연결 요청**: 선생님에게 등록 요청 (메시지 포함 가능)
- **연결 상태 조회**: 요청 상태 및 연결된 선생님 목록 확인

#### 반/클리닉

- **본인 수강 목록 조회**: 배정된 Course 목록 확인 (재원 상태 기준)
- **ClinicSlot 조회 및 선택**: 배정된 반 기준 클리닉 시간표 확인
  - 동일 teacher + branch의 슬롯 목록은 모든 Course에서 동일하게 노출
  - 학생은 teacher+branch 기준으로 Course를 묶어 동일 슬롯 목록을 확인한다.
  - 초기 등록 시 Course별 고정 클리닉 슬롯 선택 (defaultClinicSlotId 설정)
  - 동일 슬롯 중복 선택/시간 겹침은 허용하지 않음
  - 선택 후에도 학생이 직접 변경 가능 (확인 절차 포함)
- **주차별 ClinicAttendance 이동**: 해당 주차 내 다른 날짜로 변경
  - 매주 일요일 자정에 해당 주차(월~일) ClinicSession 자동 생성
  - 세션 시작 30분 전까지 같은 주 내 다른 날짜로 이동 가능
  - 횟수 제한 없음 (같은 주 내에서만)
- **ClinicAttendance 추가 신청**: 특정 날짜에 클리닉 추가 참석 신청
  - 학생이 직접 신청 (승인 없이 바로 참석)
  - 횟수 제한 없음 (최소 주1회 보장)
- **ClinicAttendance 취소**: 본인이 신청한 추가 참석을 취소
  - 세션 시작 30분 전까지 취소 가능
  - 기본 슬롯에서 자동 생성된 참석은 취소 불가
- **세션 정원/현재 참석 수 확인**: 기본 슬롯/주간 시간표에서 정원 대비 현재 참석 수를 확인
- **내 참석 세션 목록 조회**: 이번 주 기준 본인 ClinicSession/Attendance 목록 확인

#### 기타

- **Feedback 작성**: 시스템 개선 피드백 제출
- **Feedback 해결 상태 확인**: 대시보드에서 본인이 제출한 피드백의 해결 여부 확인

---

## (3) 사용자 흐름 (User Flow)

### ✅ 공통 (내 정보/임시 비밀번호)

1. **내 정보 조회**: 로그인 사용자라면 내 정보 화면에서 Member 정보를 조회한다.
   - Student는 StudentInfo를 함께 조회한다.
2. **내 정보 수정**: 이메일/이름/전화번호/비밀번호 및 StudentInfo(학생만)를 수정한다.
3. **임시 비밀번호 발급**: 이메일 + 핸드폰으로 본인 확인 후 임시 비밀번호를 즉시 발급받고 화면에 표시한다.
4. **임시 비밀번호 로그인**: 발급된 비밀번호로 로그인한 뒤 새 비밀번호로 변경하도록 안내한다.

### 👨‍💼 SuperAdmin

- 시스템에서 직접 생성 (DB seed 또는 관리자 명령)

### 👩‍🏫 Teacher

1. **선생님 회원가입**: email, password, name, phoneNumber 입력
2. **출강 학원 등록**:
   - **개인 학원**: company.name을 입력하면 Company + Branch가 동시에 생성되고 둘 다 `verifiedStatus=VERIFIED`로 저장된다(Branch 1개, Assignment=OWNER).
   - **회사 학원**: 기본적으로 VERIFIED Company/Branch 목록에서 선택한다. 존재하지 않으면 회사/지점 정보를 직접 입력해 `verifiedStatus=UNVERIFIED`로 임시 생성하고 Assignment=FREELANCE로 만든다.
3. **Branch 선택/생성**:
   - Company에 속한 Branch를 선택하거나 직접 생성한 Branch를 사용한다.
   - OWNER인 경우 Branch 정보를 수정할 수 있다.
4. **학생 연결 요청 처리**: 학생 요청 목록을 확인하고 승인/거절한다.
5. **반 생성 및 배치**: branchId와 함께 Course 생성 후 연결된 학생을 배치한다.
6. **메인 대시보드**: 반 목록, 학생 현황, 클리닉 일정, 조교 근무 현황 확인 (추후 확정)

### 🧑‍💼 Assistant

1. **일반 회원가입**: email, password, name, phoneNumber 입력
2. **Teacher 연결 대기**: Teacher가 이메일로 검색 후 배정할 때까지 대기
3. **메인 화면**: 클리닉 관리 중심 UI

### 🧑‍🎓 Student

1. **자유 가입**: email, password, name, phoneNumber 입력
   - 자동으로 STUDENT role 부여 (단일 역할)
   - StudentInfo 생성 (schoolName, grade, birthDate, parentPhone 입력 필수)
2. **선생님 검색**: 선생님 이름 + 학원/지점 필터로 검색
3. **선생님 연결 요청**: StudentTeacherRequest 생성
4. **승인 대기**: Teacher가 승인 시 TeacherStudentAssignment 생성
5. **반 배정**: Teacher가 Course에 배치하면 StudentCourseAssignment 생성
6. **고정 클리닉 슬롯 선택**:
   - Course의 teacher/branch 기준 ClinicSlot 목록 조회 (모든 Course에 동일 목록)
   - 학생이 Course별로 고정 클리닉 슬롯 선택 (defaultClinicSlotId 설정)
7. **주차별 클리닉 참석**:
   - 매주 일요일 자정에 defaultClinicSlotId 기반 ClinicAttendance 자동 생성
   - 세션 시작 30분 전까지 같은 주 내 다른 날짜로 이동 가능
   - 추가 클리닉 참석 신청 가능 (승인 없이)
8. **메인 화면**: 본인 수강 목록, 캘린더, 클리닉 시간표

---

## (4) 기능 요구 정의 방식

- 상세 기능 요구사항(FR)은 Phase별 TODO를 진행하면서 각 작업의 PLAN 문서에서 정의한다.
- Requirement 문서는 사용자/Use Case/흐름/비기능 기준만 유지하며, 구현 세부사항은 `docs/plan/<feature>_plan.md`에 기록 후 스펙/ TODO로 반영한다.
- 기능 추가나 변경이 필요하면 **반드시** requirement → spec → TODO 순으로 버전을 올린다.

---

## (5) 비기능 요구사항

| 분류                     | 요구사항                                            |
| ------------------------ | --------------------------------------------------- |
| **보안(Security)**       | JWT 기반 인증 / Role 기반 접근제어 / HTTPS 통신     |
| **성능(Performance)**    | 평균 응답속도 1초 이하, 50명 동시접속 기준          |
| **확장성(Scalability)**  | 사용자 및 데이터 증가 시 수평 확장 가능 구조        |
| **가용성(Availability)** | Docker 기반 컨테이너 배포, 장애 시 5분 내 복구 목표 |
| **데이터(Data)**         | MySQL 사용, Redis 캐싱으로 조회 속도 향상           |
| **UI/UX**                | 반응형 웹 지원 (PC/Tablet/Mobile)                   |
| **운영(Ops)**            | CI/CD 구축 (GitHub Actions → Docker → AWS EC2 배포) |

---

# 3. 설계 및 기획

## (1) 🧩 기술 스택

| **구분**                    | **기술**                                                             | **비고**                            |
| --------------------------- | -------------------------------------------------------------------- | ----------------------------------- |
| **Frontend**                | Next.js 16, React 19, Tailwind CSS 4                                 | 대시보드 UI, 반응형 인터페이스      |
| **Backend**                 | Spring Boot 4.0.0, Java 21, Spring Security, JWT                     | REST API 서버, 인증/인가 적용       |
| **Database / Cache**        | MySQL 8.4, Redis 7.4                                                 | 영속 데이터 저장 + 캐싱/세션        |
| **Infra**                   | AWS EC2, Docker, Docker Compose, GitHub Actions, Nginx Proxy Manager | CI/CD 자동 배포, Reverse Proxy 구성 |
| **Documentation / Testing** | SpringDoc OpenAPI, JUnit5, MockMvc                                   | API 문서화 및 테스트 자동화         |

## (2) 🖥️ 화면 설계 (Wireframe)

- [Google Slides 와이어프레임 보기](https://docs.google.com/presentation/d/1BrebNS9Lt8r_QTi6k4YosUah6AURUIMa8cncMejZBLs/edit?usp=sharing)
- **선생님 메인 페이지:** 대시보드 중심 (클래스, 출결, 조교 근무상황 위젯 구성)
- **조교 메인 페이지:** 클리닉 관리 중심 UI
- **학생 메인 페이지:** 캘린더 + 수강 목록 중심 UI

## (3) 주요 변경사항 (v1.4 → v1.5)

- **학생 등록 흐름 전환**: Course 신청 기반(StudentEnrollmentRequest) → Teacher 연결 요청(StudentTeacherRequest) + 반 배치(StudentCourseAssignment)
- **학생-선생님 연결 도입**: TeacherStudentAssignment로 연결 관계 관리
- **휴원/재원 on/off 기준 변경**: StudentCourseAssignment deletedAt 기준으로 관리
- **학생 검색 노출 제한**: 학생은 선생님 이름 + 출강 지점만 조회 가능
